name: Discord Patch Notes (Every Push)

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Get latest commit message
        id: commit
        run: |
          echo "msg=$(git log -1 --pretty=%s)" >> $GITHUB_OUTPUT
          echo "author=$(git log -1 --pretty=%an)" >> $GITHUB_OUTPUT
          echo "url=$(git log -1 --pretty=%H)" >> $GITHUB_OUTPUT

      - name: Send Discord Embed Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          COMMIT_MSG="${{ steps.commit.outputs.msg }}"
          AUTHOR="${{ steps.commit.outputs.author }}"
          HASH="${{ steps.commit.outputs.url }}"
          REPO="${{ github.repository }}"

          curl -H "Content-Type: application/json" \
          -d "{
            \"username\": \"GitHub Patch Notes\",
            \"embeds\": [{
              \"title\": \"ðŸš€ Push Update!\",
              \"description\": \"New patch pushed to **$REPO**\",
              \"color\": 3447003,
              \"fields\": [
                {
                  \"name\": \"ðŸ“Œ Commit Message\",
                  \"value\": \"$COMMIT_MSG\"
                },
                {
                  \"name\": \"ðŸ‘¤ Author\",
                  \"value\": \"$AUTHOR\"
                }
              ],
              \"url\": \"https://github.com/$REPO/commit/$HASH\"
            }]
          }" \
          $DISCORD_WEBHOOK
